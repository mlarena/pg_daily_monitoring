{% extends "base.html" %}

{% block content %}
<h2>–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h2>

{% if not connected %}
    <div class="alert alert-error">
        –°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL —Å–µ—Ä–≤–µ—Ä—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ <a href="{{ url_for('connect_to_postgres') }}">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Postgres</a>
    </div>
{% elif metrics %}
    {% if metrics.success %}
        <div class="info-box">
            <h3>–¢–µ–∫—É—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {{ metrics.datname }}</h3>
            <p>–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: {{ now.strftime('%Y-%m-%d %H:%M:%S') }}</p>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <h3>üë• –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
                <div class="metric-value">{{ metrics.connections }}</div>
                <div class="metric-description">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π</div>
            </div>

            <div class="metric-card">
                <h3>‚úÖ –ö–æ–º–º–∏—Ç—ã</h3>
                <div class="metric-value">{{ metrics.commits | number_format }}</div>
                <div class="metric-description">–£—Å–ø–µ—à–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
            </div>

            <div class="metric-card">
                <h3>‚ùå –†–æ–ª–ª–±—ç–∫–∏</h3>
                <div class="metric-value">{{ metrics.rollbacks | number_format }}</div>
                <div class="metric-description">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
            </div>

            <div class="metric-card">
                <h3>üìä –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ</h3>
                <div class="metric-value">{{ metrics.rollback_ratio }}%</div>
                <div class="metric-description">–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–∞—Ç–æ–≤</div>
            </div>

            <div class="metric-card">
                <h3>üì• –í—Å—Ç–∞–≤–∫–∏</h3>
                <div class="metric-value">{{ metrics.rows_inserted | number_format }}</div>
                <div class="metric-description">–í—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫</div>
            </div>

            <div class="metric-card">
                <h3>üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è</h3>
                <div class="metric-value">{{ metrics.rows_updated | number_format }}</div>
                <div class="metric-description">–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫</div>
            </div>

            <div class="metric-card">
                <h3>üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏—è</h3>
                <div class="metric-value">{{ metrics.rows_deleted | number_format }}</div>
                <div class="metric-description">–£–¥–∞–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫</div>
            </div>

            <div class="metric-card">
                <h3>üì§ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ</h3>
                <div class="metric-value">{{ metrics.rows_returned | number_format }}</div>
                <div class="metric-description">–í–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫</div>
            </div>

            <div class="metric-card">
                <h3>üíæ –ß—Ç–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞</h3>
                <div class="metric-value">{{ metrics.disk_reads | number_format }}</div>
                <div class="metric-description">–ë–ª–æ–∫–æ–≤ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ —Å –¥–∏—Å–∫–∞</div>
            </div>

            <div class="metric-card">
                <h3>üöÄ –ö–µ—à-–ø–æ–ø–∞–¥–∞–Ω–∏—è</h3>
                <div class="metric-value">{{ metrics.cache_hits | number_format }}</div>
                <div class="metric-description">–ë–ª–æ–∫–æ–≤ –∏–∑ –∫–µ—à–∞</div>
            </div>

            <div class="metric-card">
                <h3>‚ö° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–µ—à–∞</h3>
                <div class="metric-value">{{ metrics.cache_hit_ratio }}%</div>
                <div class="metric-description">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à</div>
            </div>
        </div>

        <div class="info-box">
            <h3>–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <table class="metrics-table">
                <tr>
                    <th>–ú–µ—Ç—Ä–∏–∫–∞</th>
                    <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                </tr>
                <tr>
                    <td>–ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</td>
                    <td><strong>{{ metrics.datname }}</strong></td>
                </tr>
                <tr>
                    <td>–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</td>
                    <td>{{ metrics.connections }}</td>
                </tr>
                <tr>
                    <td>–ö–æ–º–º–∏—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</td>
                    <td>{{ metrics.commits | number_format }}</td>
                </tr>
                <tr>
                    <td>–û—Ç–∫–∞—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</td>
                    <td>{{ metrics.rollbacks | number_format }}</td>
                </tr>
                <tr>
                    <td>–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–∞—Ç–æ–≤</td>
                    <td>{{ metrics.rollback_ratio }}%</td>
                </tr>
                <tr>
                    <td>–ß—Ç–µ–Ω–∏—è —Å –¥–∏—Å–∫–∞</td>
                    <td>{{ metrics.disk_reads | number_format }}</td>
                </tr>
                <tr>
                    <td>–ü–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫–µ—à</td>
                    <td>{{ metrics.cache_hits | number_format }}</td>
                </tr>
                <tr>
                    <td>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–µ—à–∞</td>
                    <td>{{ metrics.cache_hit_ratio }}%</td>
                </tr>
                <tr>
                    <td>–í–æ–∑–≤—Ä–∞—â–µ–Ω–æ —Å—Ç—Ä–æ–∫</td>
                    <td>{{ metrics.rows_returned | number_format }}</td>
                </tr>
                <tr>
                    <td>–ü–æ–ª—É—á–µ–Ω–æ —Å—Ç—Ä–æ–∫</td>
                    <td>{{ metrics.rows_fetched | number_format }}</td>
                </tr>
                <tr>
                    <td>–í—Å—Ç–∞–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫</td>
                    <td>{{ metrics.rows_inserted | number_format }}</td>
                </tr>
                <tr>
                    <td>–û–±–Ω–æ–≤–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫</td>
                    <td>{{ metrics.rows_updated | number_format }}</td>
                </tr>
                <tr>
                    <td>–£–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫</td>
                    <td>{{ metrics.rows_deleted | number_format }}</td>
                </tr>
            </table>
        </div>

    {% else %}
        <div class="alert alert-error">
            –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–µ—Ç—Ä–∏–∫: {{ metrics.error }}
        </div>
    {% endif %}
{% else %}
    <div class="alert alert-error">
        –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    </div>
{% endif %}
{% endblock %}